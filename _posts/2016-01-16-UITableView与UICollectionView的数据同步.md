---

layout: post

title:  "UITableView/UICollectionView的数据源同步问题"

date:   2016-01-16 18:33:38 +0800

categories: iOS 

tags:

- iOS

- UIKit

- 多线程

---

由于很多情况下，我们是需要在子线程使用tableView的数据源进行预排版等操作的，这就会引发多线程数据源同步的问题，比如在子线程更新数据源，而此时在主线程删除数据，随后，子线程返回了数据源，如果不经过处理，这时表现出来的现象就是之前在主线程删除的数据，又回来了。

这是问题就出现了，如何同步数据源呢？

**PlanA: 串行访问**

可以通过创建串行队列，将主线程&子线程的更新数据源的任务，放到串行队列中，保证数据顺序执行。

但是这种方案也有弊端，由于是串行队列，任务等待会产生短暂的延时的问题

**PlanB: 并发访问，拷贝数据**

以上述例子来说，子线程在拷贝了主线程的数据之后，主线程删除数据时，记录这个删除操作，子线程在同步数据之前，去同步一下主线程已经进行的操作（如删除操作），再去reload，就不会有数据不同步的问题了。

同样，这种方案也有一些弊端，由于需要存储操作&数据拷贝，这个方案需要额外的内存开销

具体实际应用应当根据场景不同采取不同的方案。
